# GRPC

## What is grpc?

grpc 是一个健壮的开源的远程过程调用框架，用于构建可扩展快速的API。它允许客户端和服务端进行透明的连接，开发关联的系统。许多大科技公司使用grpc。这个框架信赖http／2，protocol buffers及其它现代技术，确保API的安全，性能和可扩展性。

### gRPC历史

2015年，谷歌开发了grpc，这是一个RPC框架的扩展，来连接由不同技术创建的微服务。后来开源，广泛用于web，mobil，loT。

## gRPC 基本概念

gRPC优于json 和 XML ，并提供了API安全，它采用了以下技术：

#### Protocol Buffers

Protocol buffers,　Protocolbuf，是谷歌的序列化协议，它很容易定义服务并自动生成客户端库。gRPC使用protocol buffer作为他们的界面定义语言　Interface Definition Language(IDL) 和序列化工具集。当前的版本是　proto3 ，有最新的特性，更容易使用。

客户端和服务端的gRPC服务和信息定义在proto文件中，Protobuf编译器 `protoc`,用来生成客户端和服务端代码，运行时加载 `.proto` 放在内存中,并序列化二进制信息。代码生成后，信息可以在客户端和服务端进行交流。

相对于json有巨大的性能提升，对硬件的要求也很低。

#### 流式传输

Streaming是另一个关键的概念。它允许在一个单一的连接中同时进行多个进程。HTTP2的多路复用能力提供了这个能力。下面是几种不同的流传输模式

- 服务端流rpc 客户端发送单一的请求到服务器，服务端持续发送相关数据流，直到发送数据完成。
- 客户端流rpc 客户端发送流数据到服务端，服务端处理后发送单一的响应。同样的，gRPC保证数据流的完整。
- 双向流　rpc 客户端和服务端同时双向向对方发送流数据，它们的操作相互独立。

#### HTTP/2

gRPC基于HTTP2开发，http22015年发布，克服了http1.1的局限，并兼容http1.1 http1.2。它有以下特性：

- 二进制帧层　http2把请求和响应分割成小段信息并封装为二进制的帧格式。使信息传输更有效率。并使得多路复用成为可能
- 流式　客户端和服务端可同时进行双向数据流通
- 流量控制　对多个流进行流量控制
- 头部压缩　所有数据在发送前进行压缩，显著的提高了性能。

所有这些特性，使得gRPC使用更少的资源，更少的时间来处理数据传输数据。


#### 通道

通道是gRPC的核心概念，http2流允许在一个连接上同时进行多个流的操作。通道扩展了这个概念，支持在多个连接上的多个流的操作。　

## gRPC 架构

## gRPC优势

1. 性能
  10x性能于REST+JSON
1. 流式处理 更容易构造流式服务
    - Unary no streaming
    - Client side streaming
    - Server side streaming
    - Bi-directional streaming
1. 代码自动生成
  `protoc` 为多种语言自动生成代码
1. 互通性
1. 安全　
    可使用tls 对数据进行端对端的加密。
1. 可用性和生产效率
1. 内置的必要的特性
  如元数据交换、加密、认证、超时、负载平衡、服务发现等

## gRPC 弱势

1. 有限的浏览器支持
1. 可读性差，二进制
1. 没有缓存
1. 有一定的学习曲线

## 一定要使用gRPC？

在多语言，低延迟，高并发，低配置，低带宽，实时性要求高，大规模微服务连接，基于http2的环境。可以用gRPC